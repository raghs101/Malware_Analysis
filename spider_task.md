**MALWARE ANALYSIS DOCUMENTATION**

**Raghavendra
108122037**

**Level 1:**

To Display the basic File information we use Flask to make required GUI , the uploaded file get Downloaded into the static directory. The file\_info.py file is for mainly this module has class File\_Analysis which is further imported into the Malware\_Analysis.py there we create a File\_Analysis object through which we get the required file information. The File\_Analysis has  several functions to get the strings of the file , I used subprocess module and strings in ubuntu terminal which gets the strings of the file in a ubuntu machine. The file is converted into its sha\_256 in chunks so that even large files can be processed and it is ensured in no stages it is given executable permission in the main ubuntu machine. This results are displayed after uploading the file it is redirected to results page. Which renders the results.html.

**Level 2**:

For this the above program uses Angr to make the both network cfg graph and cfg emulate functions present in the Analyst.py module which is imported in malware\_analysis.py.

**Level  3:**

The First for Dynamic analysis is to setup the Lab in a isolated environment, Isolation is possibly done using a Hypervisor , I used VirtualBox to do the Isolation. Remnux and lubuntu where used for isolation. Lubuntu is the VM which executes the possible malware sample. For  Dynamic analysis we should both host isolation and network isolation. The isolation from the host machine is taken care by the hypervisor which provides separate virtual disks to load the file. Ensure that no kind of personal data is stored in the VM where malware is going to be executed. 

Download the iso of the lubuntu image available online it is a lighter version of the ubuntu. This mainly focuses on the malwares in elf files since I didn’t have a windows license. Also Download the remnux ova from the official page. The isolation from host is already taken care of by the virtualbox/hypervisor. For network isolation either we could use openvpn or simulate own fake internet. In this project I used fake internet option since it is much faster and more safer than a VPN.

The lubuntu is setup after installing tools  like ssh and psutil initially it is given a NAT type network adapter to make initial installations. After which the lubuntu machine is isolated from the original network and given a internal network adapter with the remnux machine. The remnux machine is a ova which can be imported directly to virtualbox. Network isolation both remnux and lubuntu are isolated with a internal network.

![Screenshot from 2024-01-17 18-52-27.png](Aspose.Words.040d0019-9041-4b9a-8c67-a5da7fd1bb0c.001.png)

The virtualbox provides separate router like configuration for both remnux and lubuntu.

Using inetsim tool in remnux we can provide a fake internet simulation  before which we mave to configure the /etc/resolv.conf file present in the lubuntu machine, and also configure the /etc/netplan inside this directory there will be configurations for various network adapters. Here we should set a static ip , By setting the dhcp4 : no and addresses : provide any sufficient address in this case it is 192.168.1.16 for lubuntu and 192.168.1.17 for remnux. In the /etc/resolv.conf set the nameservers  parameter to the ip of the remnux machine in this case 192.168.1.17 ,this will route the internet traffic to the remnux machine which act as a fake internet.

![Dynamic Malware Analysis with REMnux v5 – Part 1 | Count Upon Security](Aspose.Words.040d0019-9041-4b9a-8c67-a5da7fd1bb0c.002.png)

The remnux responds with fake dns and fake https to communicate with lubuntu. This is further stored in the inetsim reports. The remnux is given two adapters one internal and one host-only.As we have  discussed the internal network is for the communication with lubuntu while the host-only network is set so that the host can communicate with the remnux machine which further communicates with the lubuntu machine.

![VirtualBox network settings – VMs use the host-only network](Aspose.Words.040d0019-9041-4b9a-8c67-a5da7fd1bb0c.003.png)![VirtualBox-network-settings-–-VMs-use-the-host-only-network.png](Aspose.Words.040d0019-9041-4b9a-8c67-a5da7fd1bb0c.004.png)

We may have set the ip’s for the remnux and lubuntu internal networks manually using sudo ip addr add or changing the file present in the netplan directory. Changing in file in netplan directory ensures that everytime we bootup the machine the address remains.

There are two scripts present in the vm\_scripts directory one for remnux and other for the lubuntu machine with username kali.

The conversation between these machines is done using ssh , to automate the ssh conversations I used paramiko library from python. The remnux includes return.py remnux\_scripts.py, The host contains the scp\_trans.py. On executing this file the host machine transfers the uploaded file to the remnux machine and this scp\_trans.py also executes reme\_exe.sh file which in turn transfers the uploaded file into the lubuntu machine and also starts the inetsim. The kali\_scripts.py extracts the files accessed and directories made this is done using the strace command. The output of the command is stored in the out.txt file and the  access calls and mkdir openat are extracted using regex expressions. For extracting the process trees psutil and graphviz modules were used these are then stored in dat files using the pickle module . It is made sure that the file runs as a sudo user for this purposes the analyse.sh file is ran with sudo privellages sudo –S ./analyse.sh and password is provided with stdin of ssh. The kali\_scp file returns the dat files to the remnux machine and also runs the ./return.sh file which stops the inetsim and also return the dat and remnux reports to the results directory present in the host machine. Which are further displayed on the web.

**Risks:**

Since it is automated using ssh I had to provide passwords which are visible in the scripts which is a threat although no one can access the machines remotely it is still a risk.

