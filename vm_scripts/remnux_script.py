import paramiko
import sys
file = sys.argv[1]

class scp_tra:
    def __init__(self,file_path):
        self.file_path = file_path
    def transfer(self):
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

        

        ssh.connect("192.168.1.16", port=22, username="kali", password="kali@12")

                
        scp = ssh.open_sftp()
        a = self.file_path.split('/')
        
        
        
        
        scp.put(f"{self.file_path}",f"/home/kali/{a[-1]}")
        ssh.exec_command(f"chmod +x {a[-1]}")
        scp.close()
        ssh.close()


class ssh_trans:
    def __init__(self,file_path):
        self.file_path = file_path
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        a = self.file_path.split('/')
        
        

        ssh.connect("192.168.1.16", port=22, username="kali", password="kali@12")
        command1 = f"sudo -S ./analyse.sh {a[-1]}"  # Use sudo -S for interactive password prompt
        stdin, stdout, stderr = ssh.exec_command(command1)
        sudo_password = "kali@12"

            # Send the password to the interactive prompt
        stdin.write(sudo_password + '\n')  # Ensure password is correct and newline is added
        stdin.flush()
        
        a = stdout.read().decode('utf-8')
        
        ssh.close()

cs = scp_tra(f"{file}")
cs.transfer()
ssh_trans(f"{file}")
